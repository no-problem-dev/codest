#!/bin/bash

echo "インストール後の処理を開始します..."

# 権限の設定
echo "権限を設定しています..."
chmod 755 /usr/local/bin/codest
chmod -R 755 /usr/local/lib/codest

# シンボリックリンクの作成
echo "シンボリックリンクを作成しています..."
if [ -f "/usr/local/lib/codest/bin/codest" ]; then
    ln -sf /usr/local/lib/codest/bin/codest /usr/local/bin/codest
fi

# PYTHONPATHの設定
BASHRC="$HOME/.bashrc"
ZSHRC="$HOME/.zshrc"
PYTHONPATH_LINE='export PYTHONPATH="/usr/local/lib/codest:$PYTHONPATH"'

# .bashrcに追加
if [ -f "$BASHRC" ]; then
    if ! grep -q "PYTHONPATH.*codest" "$BASHRC"; then
        echo "PYTHONPATHを.bashrcに追加しています..."
        echo "$PYTHONPATH_LINE" >> "$BASHRC"
    fi
fi

# .zshrcに追加
if [ -f "$ZSHRC" ]; then
    if ! grep -q "PYTHONPATH.*codest" "$ZSHRC"; then
        echo "PYTHONPATHを.zshrcに追加しています..."
        echo "$PYTHONPATH_LINE" >> "$ZSHRC"
    fi
fi

echo "インストール後の処理が完了しました"
exit 0